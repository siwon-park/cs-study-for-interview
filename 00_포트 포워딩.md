# 00_포트 포워딩

> Port Forwarding

## 1. 포트 포워딩

### 1) 개념

공유기의 포트를 통해 공유기와 연결된 기기들의 특정 포트에 진입할 수 있게 해주는 것.

컴퓨터 네트워크에서 패킷이 라우터나 방화벽과 같은 네트워크 게이트웨이를 통과하는 동안 네트워크 주소를 변환해주는 것. 다시 말해서 외부에서 접속이 가능하도록 해주는 것.

<br>

### 2) 포트 포워딩이 필요한 이유?

컴퓨터 1에 웹 서버를 `80`번 포트로 열었다고 가정해보자.

![image](https://github.com/siwon-park/cs-study-for-interview/assets/93081720/f7c28b60-d48a-4045-84f4-02474275d388)

외부에서 다른 사람이 컴퓨터1에 열린 웹 서버에 접근하기 위해서는 사설 IP(Private IP)를 알려주면 접근할 수 없다. 왜냐하면 사설 아이피는 특정 대역으로 사설 네트워크 안에서 유동적으로 부여되는 IP이기 때문에 외부에서는 컴퓨터 1의 사설 IP만을 가지고는 식별할 수 없다.

단, 만약 컴퓨터1이 공인 IP(Public IP)를 가지고 있다면 당연히 외부에서 접근할 수 있다.

<br>

그래서 공유기의 공인 IP를 알아야 하는데, 그렇다면 공인 IP와 포트 번호 `80`만 알면 컴퓨터 1에 열린 웹 서버로 접근할 수 있을까?

**그렇지 않다.**

![image](https://github.com/siwon-park/cs-study-for-interview/assets/93081720/73078b8d-0761-4969-ae96-2fc6f46ed5ff)

바로 공유기의 공인 IP의 80번 포트까지만 도달하고 끝나버린다.

그렇기 때문에 공유기의 공인 IP의 80번 포트로의 연결을 컴퓨터1의 80번 포트로 연결하라고 설정을 해줘야 하는데, 이를 바로 **포트 포워딩**이라고 한다.

<br>

### 3) 포트 포워딩 설정

포트 포워딩을 설정하고 나서야 비로소 외부에서 사설 IP의 특정 포트로 접속할 수 있게 된다.

![image](https://github.com/siwon-park/cs-study-for-interview/assets/93081720/8cfde693-323d-4522-bc90-0fc2b6894b3f)

<br>

### 4) 포트 포워딩 참고 사항

- 포트 포워딩은 기본적으로 대부분의 공유기에서 제공하는 기능이므로, 공유기에서 설정을 할 수 있다.
  - 공유기라고 해서 특별한 장비를 생각하면 이해가 어려울 수도 있으니 공인 IP가 부여된 장비는 공유기 역할을 할 수 있다고 보는 게 더 낫다.
  - 로컬호스트와 VM 간에 포트 포워딩도 가능하다.
    - VM의 80번 포트에 웹 서비스를 띄웠다고 했을 때, `localhost:80`으로 접근할 수 없다. 왜냐하면 localhost의 80번 포트로 서비스가 열린 게 아니기 때문이다.
    - 따라서 localhost의 80번 포트로 들어왔을 때, VM의 80번 포트로 연결될 수 있도록 포트 포워딩을 해줘야 한다.
- 외부 포트와 내부 포트는 서로 다를 수 있음
  - `80`번 포트를 `8080`포트로 포트 포워딩 가능 (Docker 이미지를 실행할 때 포트를 지정하는 것을 생각해보면 이해가 쉬움)
- 하나의 포트로 들어오는 연결을 두 IP로 포워딩 하는 것은 불가능함. 즉, 하나의 포트는 하나의 포워딩만 가능하다.
- 내부에서 연결하려는 포트는 반드시 IP를 지정해야 한다.
- 공유기가 할당한 IP에만 포워딩이 가능하다.