# 05_프로세스 관리(Process Management)

컴퓨터 세계에서는 부모가 자식보다 더 오래 산다.

## 1. 프로세스의 생성/방법/종료

### 1) 프로세스의 생성

부모 프로세스(Parent Process)가 자식 프로세스(Child Process)를 생성한다. 

- 생성 방법: 하나의 부모가 자식을 한 개 또는 여럿을 **복제**하는 방식으로 생성함
  - 트리 형태의 프로세스 계층 형성

※ **부모 프로세스가 자식 프로세스를 복제하고나서 부턴 자식 프로세스는 별도의 독립적 프로세스임**

<br>

#### (1) 자원 공유 모델

- 원칙적으로는 전혀 공유하지 않는게 기본 => 프로세스는 서로 경쟁 관계(자원을 더 많이 차지하려함)
- 부모와 자식 프로세스가 모든 자원을 서로 공유함
- 서로 일부만 공유함

#### (2) 수행

- 부모와 자식이 공존하며 일을 수행하는 경우
- 자식이 종료될 때까지 부모가 기다리는 경우

<br>

### 2) 프로세스의 생성 방법

운영체제에 시스템 콜을 통해 생성할 수 있음

#### (1) 과정

- 부모가 시스템 콜을 하여 운영체제에게 자식의 생성(복제)을 부탁함
- 운영체제에 의해 자식이 복제되며, 부모의 주소공간 및 운영체제에 있는 데이터도 복사
- 자식 프로세스가 복사한 공간에 새로운 프로그램을 올림

예) 유닉스에서 fork() 명령어로 복제, exec() 명령어로 새로운 프로그램을 올림

#### (2) Copy On Write 기법 (COW 기법)

리눅스와 같은 효율적인 운영체제에서는 바로 자식을 copy하지 않고 프로그램 카운터만 1개 복사해서 쓰다가 부모와 자식이 스택, 데이터 등에서 서로 다른 값을 가르키는 순간 그제서야 부모의 메모리 공간을 일부 복사하여 자식에게 준다.

이렇게 하는 이유는 처음에 같은 일을 하고 있는데, 무작정 복사부터 하면 비효율적이기 때문.

따라서 처음엔 공유를 하다가 이후에 복제하는 개념임

#### (3) 명령어

##### 1. fork() 시스템 콜 - create a child(copy)

자식은 fork() 시스템 콜에 의해 복제되고 main이 아니라 fork이후의 코드부터 실행함 => 부모도, 자식도 fork이후의 코드라인부터 실행하므로 부모와 자식의 구분이 필요한데, 부모의 fork결과 반환 값은 양수, 자식은 0이기 때문에 구분 가능함

##### 2. exec()  시스템 콜 - overlay new image

어떤 프로세스를 완전히 새로운 프로세로 탄생시켜주는 시스템 콜

##### 3. wait() 시스템 콜 - sleep until child is done

프로세스 A가 wait() 시스템 콜을 하면, 커널은 A의 자식이 종료될 때까지 프로세스 A를 sleep시켜 blocked로 만듦. 자식이 종료되고 나면 커널은 프로세스 A를 깨워서 ready 상태로 만듦

##### 4. exit() 시스템 콜 - frees all the resources, notify parent

프로세스를 종료하고 자원을 반납함

- 자발적 종료: exit() 시스템 콜
- 비자발적 종료: 외부에서 강제로 종료시킴
  - 부모가 자식을 강제로 종료
  - kill이나 break 등을 입력하여 종료
  - 부모가 종료되는 경우

<br>

### 3) 프로세스의 종료(Process Termination)

- 프로세스가 마지막 명령 수행 후 이를 운영체제에 알림(`exit`)
  - 자식이 부모에게 output데이터를 보내고, 프로세스의 각종 자원들이 운영체제에 반납됨
- 부모가 자식의 수행을 종료시킴(`abort`)
  - 자식이 할당 자원의 한계치를 넘어선 경우
  - 자식에게 더 이상 할당된 태스크가 필요하지 않는 경우

- 부모가 먼저 종료되는 경우, 운영체제는 자식이 더 이상 수행되도록 두지 않는다. (단계적 종료)

<br>

## 2. 프로세스 간 협력

### 1) 독립적 프로세스(Independent)

원칙적으로 하나의 프로세스가 다른 프로세스의 수행에 영향을 미치지 못함

<br>

### 2) 협력 프로세스(Cooperating)

프로세스 협력 메커니즘을 통해 하나의 프로세스가 다른 프로세스의 수행에 영향을 줌

<br>

### 3) 프로세스 협력 메커니즘(IPC: InterProcess Communication)

#### (1) Message Passing

커널을 통해 메세지를 전달함

- Direct communication : 통신하려는 프로세스의 이름이 명시되어 있어 해당 프로세스와 커널을 통해서 메세지를 주고 받음
- Indirect communication : 메일 박스나 포트에 메세지를 남겨서 (불특정) 프로세스와 통신함

#### (2) Shared Memory

프로세스 간 주소 공간을 공유함

※ 스레드는 하나의 프로세스에 CPU 수행단위가 여러 개 있는 것이기 때문에 프로세스 간 협력으로 보기는 어렵지만 동일한 프로세스를 구성하는 스레드 간에는 주소 공간을 공유하므로 협력이 가능함