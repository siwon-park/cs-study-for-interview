# 00_TCP, UDP 프로토콜

> TCP, UDP 프로토콜의 특징과 차이점

※ 프로토콜? 두 개체 간의 데이터 교환을 원활히 하기 위한 통신 규약

`OSI 4계층; 전송(Transport) 계층`의 프로토콜

<br>

## 1. TCP (연결 지향)

> TCP; Transmission Control Protocol

TCP는 연결 지향형 프로토콜로, 인터넷에 연결된 컴퓨터에서 실행되는 프로그램 간에 일련의 데이터를 `안정적으로, 순서대로, 에러 없이` 교환할 수 있게 해주는 프로토콜을 말한다.

통신 및 데이터 교환에 `신뢰성이 보장`되어야 하는 만큼 UDP에 비해 `속도가 느리다`는 특징이 있다.

따라서 `파일 전송`과 같이 신뢰성이 보장되어야 하는 서비스에 주로 사용되는 프로토콜이다.

TCP는 IP와 함께 많이 사용되기 때문에 TCP/IP 프로토콜이라고 묶어서 부르기도 한다. (물론 하나의 개념이 아니다.)

- IP 주소 체계를 따르고, IP Routing을 이용해서 목적지에 도달한 다음, TCP의 특성을 활용해서 송신자와 수신자의 논리적 연결을 생성하고 신뢰성을 유지한다.

### 1) TCP 특징

#### (1) 신뢰성 보장

패킷의 손실, 중복, 순서 변경 등이 없도록 보장

#### (2) 연결 지향적

TCP/IP 3-way handshaking, 4-way handshaking

연결을 수립하고 그 상태를 확인해가며 통신함

#### (3) 흐름 제어

흐름 제어를 통해 송신 및 수신 속도를 제어, 조절 가능

송신자는 자신이 데이터를 한 번에 얼마나 보낼 수 있는지, 수신자는 자신이 데이터를 어디까지 받았는지 끊임없이 확인함

- 이것 때문에 대기(wait)가 발생함
- 송신자측에서 무조건적으로 데이터를 보내지 않고, 몇 개 보내다가 멈추고 수신자가 이제까지 몇 개 받았으니 다음 번에 몇 번을 달라고(`ACK`) 보낼 때까지 `대기(wait)`함

TCP 버퍼의 `Window Size`를 통해 한 번에 주고 받을 수 있는 데이터의 크기를 설정함. (수신자측에서 상황에 맞게 정함)

- 메세지 세그먼트의 크기가 현재 수신자의 window size보다 크다면 송신자는 데이터를 보내지 않고 window size가 적정한 수준이 될 때까지 대기함
- window size > segment 일 때 데이터 송신 재시작
- window size는 TCP 버퍼에 쌓인 세그먼트를 송신자 어플리케이션이 빨리 가져가야 증가함. TCP 버퍼에 세그먼트가 계속해서 쌓이고 비워지지 않으면 window size는 점차 작아짐
  - 파일 전송이 느리다고 네트워크에만 문제가 있다고 보기 어려운 부분 중 하나
  - window size가 원인인 경우 어플리케이션에서 빨리 비워줘야 하는 부분이기 때문에 앱의 문제

- 수신자가 지금까지 받은 데이터 양을 확인하여 송신자에게 보내는데 이를 `Acknowledgement Number(ACK Num)`라고 한다.
- 그리고 이 데이터의 순서 번호를 표기한 것이 `Sequence Number`이다.

#### (4) 혼잡 제어

네트워크가 혼잡하다고 판단될 때 혼잡 제어 기법을 통해 송신율을 제어할 수 있음

- `Slow Start`: 송신자가 연결 초기에는 데이터 양을 조금만 보내다가 수신자의 수신을 확인하며 데이터 전송량을 늘려감

<br>

### 2) 다른 프로토콜과 조합

TCP/IP 프로토콜은 다른 프로토콜과의 조합을 통해 다양한 어플리케이션에서 여러 기능들을 제공, 처리할 수 있다.

예를 들어 메일 서비스를 제공하려면

- (송신) SMTP + TCP/IP
- (수신) POP3 + TCP/IP

를 조합하여 사용하면 된다.

결국에는 무엇을 할 것인지가 중요.

<br>

### 3) TCP/IP 4계층

![image](https://github.com/siwon-park/cs-study-for-interview/assets/93081720/2a6d0ddc-5bdd-4b9e-b5d8-5bac84ee9502)

#### (1) 송신측

데이터 전달을 위해 계층을 지날 때마다 헤더를 붙인다. (`캡슐화`)

- 응용 계층 : 어플리케이션 헤더
  - HTTP 통신일 경우 HTTP 헤더
- 전송 계층 : **TCP 헤더** (송신지 포트번호 + 수신지 포트번호)
- 인터넷 계층 : **IP 헤더** (송신지 IP 주소 + 수신지 IP 주소)
- 네트워크 계층 : **이더넷 헤더** (송신지 MAC 주소 + 수신지 MAC주소)

#### (2) 수신측

데이터 수신을 위해 계층을 지날 때마다 헤더를 뗀다. (`역캡슐화`)

- 네트워크 계층 : 인터넷 계층으로 패킷을 올려보냄
- 인터넷 계층 : IP 헤더를 뜯어서 발신지를 확인하고, 수신자가 자기 자신일 경우 해당 패킷을 전송 계층으로 전달
- 전송 계층 : TCP 헤더를 뜯어서 발신/수신 포트 확인 후, 데이터 검사 후에 이상이 없다면 순서를 정렬하여 원래 데이터 형태로 만들어 응용 계층으로 전송한다. (수신 포트에 해당하는 프로세스로 보냄)
- 응용 계층: 어플리케이션 헤더를 뜯어서 받은 데이터에 대한 적절한 조치를 취한다. (읽기, 저장 등)

<br>

## 2. UDP (비연결 지향)

> UDP; User Datagram Protocol

UDP는 TCP와 달리 `비연결성`이고, 데이터 교환 성공에 `신뢰성이 없으며`, `순서화 되지 않은` 데이터를 교환할 수 있게 해주는 프로토콜이다.

데이터 교환에 신뢰성이 보장되지 않기 때문에 TCP에 비해서 `속도가 빠르다`는 특징이 있다.

따라서 UDP는 빠른 요청과 빠른 응답이 필요한 `스트리밍`과 같은 실시간 서비스에 더 적합하다.

### 1) UDP 특징

- 비연결성 & 비신뢰성
  - 논리적인 가상회선이 필요 없으며, 메세지가 제대로 도착했는지 확인하지 않음
- 순서화 되지 않음
  - 수신된 메세지의 순서를 맞추지 않음
  - 따라서 먼저 보낸 데이터가 나중에 수신될 수도 있음
- 실시간 응용 및 멀티 태스킹 가능
  - 빠른 요청과 응답이 필요한 서비스에 적합
  - UDP가 속도가 빠른 이유는 TCP/IP 프로토콜처럼 매번 연결을 확인할 필요가 없기 때문