# 00_쿠키와 세션

> 쿠키와 세션에 대한 이해

<br>

## 1. 요약

| 항목          | 쿠키(Cookie)                                                 | 세션(Session)                                       |
| ------------- | ------------------------------------------------------------ | --------------------------------------------------- |
| 저장 위치     | 클라이언트, 웹 브라우저(로컬)                                | 서버                                                |
| 보안          | 취약(탈취 및 조작 가능성)                                    | 강함(세션 ID를 통해 구분)                           |
| 라이프 사이클 | 쿠키 생성 시 설정<br />(설정하지 않으면 브라우저 종료 시 만료) | 브라우저 종료 시 소멸                               |
| 속도          | 빠름<br />(요청하는 쪽에 정보가 있기 때문에 빠름)            | 느림<br />(정보가 서버에 있어 처리가 요구되어 느림) |
| 저장 형태     | Text                                                         | Object                                              |
| 용량          | 제한 있음<br />(총 300개, 도메인당 20개, 쿠키 당 4 KB)       | 제한 없음<br />(서버가 허용하는 한 제한 없음)       |

쿠키와 세션을 둘 다 사용하는 이유는 세션만 사용하면 서버의 자원을 무분별하게 사용하게 되기 때문에 성능 저하를 초래한다. 

따라서 중요한 정보는 세션에, 중요하지 않은 정보는 쿠키에 저장하여 사용함으로써 사용자에게 편의성을 제공할 수 있다. 웹 설계 시에도 어떤 정보를 쿠키에 저장하고 어떤 정보를 세션에 저장할지 적절히 잘 선택하여 이를 반영해야 한다.

<br>

## 2. HTTP 프로토콜

> 인터넷 상에서 데이터를 주고 받기 위한 서버/클라이언트 모델을 따르는 통신 규약(프로토콜). Hyper Text Transfer Protocol

쿠키와 세션을 이해하기 위해선 먼저 http 프로토콜에 대한 이해가 선행되어야 한다.

http 프로토콜은 `비연결성(Connectionless)`과 `비상태성(Stateless)` 특징을 갖고 있다.

이는 `서버의 자원을 절약하기 위해` 모든 사용자의 요청마다 연결과 해제 과정을 거치지 않기 때문에 연결 상태가 유지되지 않고, 해제 후에 상태 정보가 저장되지 않음을 의미한다.

그런데 실제로 우리가 인터넷을 사용하다 보면 다시 접속했음에도 불구하고 로그인 상태가 계속 유지되어 있거나 다른 정보들이 저장되어 있는 경우를 볼 수 있다.

여기서 등장하는 개념이 `쿠키`와 `세션`이다.

<br>

## 3. 쿠키(Cookie)

> 클라이언트에 저장되는 Key와 Value로 구성된 String으로 이루어진 Text

웹 사이트에 접속할 때 생성되는 정보들을 담은 임시 파일로, 사용자의 웹 브라우저에 저장되는 데이터이다.

### 1) 과정

서버가 사용자의 정보를 쿠키에 저장하여 응답과 함께 반환하고, 이후의 요청 및 응답에 헤더에 쿠키를 같이 보내는 방식으로 소통한다.

![image](https://github.com/siwon-park/Problem_Solving/assets/93081720/1d5e8988-8929-4aab-a4b8-dacea84e39ca)

### 2) 사용 목적

즉, 원래라면 서버 측에 저장되어야 할 사용자 정보를 웹 브라우저(사용자의 로컬 호스트 머신)에 저장함으로써 서버의 부담을 줄이고, 사용자의 정보를 유지할 수 있게 해준다.

#### 세션 관리

로그인, 사용자 닉네임, 접속 시간, 장바구니 등과 같은 서버가 알아야 할 정보들을 저장하고 유지할 수 있음

#### 개인화

사용자를 인식하여 사용자마다 개인화된 적절한 페이지를 보여주기 위해 사용함

#### 트래킹

사용자의 행동과 패턴을 분석하고 기록할 수 있음

- 그래서 웹 사이트마다 쿠키 사용에 대한 Policy를 미리 보여주고 동의를 받는 경우도 있음

<br>

### 3) 사용 예시

대게 다음과 같은 곳에 주로 사용된다. 만약 쿠키가 없다면 이러한 정보들을 서버쪽에 계속해서 넘겨줘야 한다.

- ID 저장, 로그인 상태 유지 박스 활성화
- 일주일 간 다시 보지 않기
- 최근에 검색한 제품 리스트들, 쇼핑몰 장바구니 등

<br>

### 4) 쿠키의 단점

쿠키는 보안적인 측면에서 단점이 존재한다.

- 방문했던 웹 사이트에 대한 정보나 해당 웹 사이트를 이용하면서 입력한 개인정보가 기록되기 때문에 사생활 침해 소지가 있다.
  - 이를 위해 사이트마다 쿠키 정책(Cookie Policy)가 존재하는데 이를 거부할 경우 쿠키를 사용할 수 없어 웹 브라우저와 서버의 연결 정보를 유지하는 기능을 하지 못할 수도 있다. 
- 쿠키는 서버 측에서 가지고 있는 정보가 아니라 클라이언트 측에서 가지고 있는 정보이며, 텍스트형태로 저장되기 때문에 쉽게 임의로 고칠 수 있고 누군가 가로채기도 쉽다.
  - 따라서 쿠키에는 민감한 정보를 담는 것을 지양해야 한다.

<br>

## 4. 세션(Session)

> 서버 측에서 관리하고 있는 사용자 정보

웹 사이트에 접속할 때 생성되는 정보들을 담은 임시 파일로, 서버에서 관리하는 데이터이다.

### 1) 과정

서버 측에서는 클라이언트를 구분하기 위해 클라이언트 당 하나의 세션 ID를 발급하고 이를 서버에 저장하고 있다가 브라우저가 종료되면 소멸시킨다.

또한 세션을 사용한다고 해서 쿠키를 사용하지 않는 것이 아니기 때문에 이를 유의해야 한다.

서버는 사용자 요청이 있을 때, 세션 ID를 생성하고 이를 쿠키에 담아 전달한다. 이후 사용자가 요청했을 때 쿠키에 있는 세션 ID 정보를 읽어서 세션 ID를 통해 세션에 있는 클라이언트 정보를 가져와서 응답하는 것이다.



![image](https://github.com/siwon-park/Problem_Solving/assets/93081720/5a4d65a8-33aa-4e49-a0b4-975e6ed3c365)

<br>

### 2) 사용 목적

- 쿠키의 보안적인 한계를 극복하기 위해 사용
  - 쿠키의 단점: 탈취 위험성 및 임의 수정 가능 등
- 아이디, 닉네임과 같은 정보를 DB에 저장하지 않고 세션에 저장함으로써 DB 레벨까지 접근할 필요 없어 효율적임

<br>

### 3) 사용 예시

- 로그인과 같은 보안상 중요한 작업 및 정보들을 세션에 저장해두고 클라이언트가 브라우저를 사용하는 동안만 상태 유지
  - 단, 로그인했을 때 발급받은 세션 ID와 로그아웃하고 나서 다시 로그인했을 때 받은 세션 ID는 다르다.
  - 즉, 로그인했다가 로그아웃하고 다시 로그인한다면 서버 측에서는 새로운 사용자로 인식한다.

<br>

### 4) 세션의 단점

세션은 사용자 정보를 서버 측에서 저장하고 관리하기 때문에 서버 측의 리소스를 사용하게 된다.

따라서 세션이 많아지면 서버 메모리를 많이 차지하게 되어 서버에 부담을 주게 된다.



