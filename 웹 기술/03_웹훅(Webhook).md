# 03_웹훅(Webhook)

> 웹훅이란?

## 1. API와 Webhook

![image](https://github.com/user-attachments/assets/0178f30e-6386-457c-9cfc-78a75d1df561)

### 1) API

일반적인 API는 클라이언트가 서버로 폴링(Polling) 방식으로 요청을 보내고, 서버는 요청에 응답하는 방식이다.

데이터를 가져오려면 클라이언트가 필요할 때마다 직접 호출해야 한다.

문제는 가져오려는 데이터가 일반적으로 저장되는 데이터(예- 유저 정보, 게시글 정보 등)라면 필요할 때마다 호출해도 문제가 없지만, 특정 이벤트와 관련된 데이터(예- 메일 수신 등)라면 서버가 최신화된 데이터를 지금 갖고 있는지 모르기 때문에 매번 특정 주기로 호출해서 가져와야 한다는 것이다.

### 2) Webhook

반면에 웹훅은 특정 이벤트가 발생했을 때 서버가 미리 정의된 클라이언트의 URL로 반대로 요청을 보내는 역방향 API 방식을 말한다.

webhook은 api에 비해 실시간 통신이 필요하거나 이벤트 기반의 작업이 필요할 때 더 적합한 방식이다.

webhook은 비동기 처리 방식과는 거리가 있다. 일반적인 비동기 api 방식도 클라이언트가 요청을 보내는데, webhook은 아예 요청 방향이 반대이기 때문에 유의할 것.

<br>

## 2. Webhook

"A webhook in web development is a method of augmenting or altering the behavoir of a web page or weba application with custom callbacks"

"웹훅은 웹 페이지 혹은 웹앱에서 발생하는 특정 이벤트들을 커스텀 콜백으로 변환해주는 방법이다"

※ 콜백 url: 서버측의 이벤트를 클라이언트로 보낼 때, 클라이언트가 받을 url 주소

### 1) Webhook의 주요 특징

#### (1) 이벤트 기반

서버에서 발생하는 특정 이벤트(예- 메일 수신이 되었을 때, 결재가 완료 되었을 때 등)를 감지하고 미리 지정된 엔드포인트(콜백 url)로 데이터를 전송한다.

- 결제 처리 시스템에서 결재가 성공 혹은 실패했을 때 webhook을 통해 사용자 시스템쪽으로 결제 결과를 실시간으로 전달
- CI/CD 파이프라인을 구축하여 Git에서 특정 브랜치에 push를 했을 때 webhook을 이용하여 CI/CD 서버로 이벤트를 전송하고 자동으로 빌드 및 테스트를 수행 (Git이 데이터를 보내는 서버고, CI/CD가 클라이언트)
- 알림 시스템, 고객 지원 도구(예-Zendesk)에서 새로운 티켓이 생성되면 webhook을 통해 사내 시스템으로 알림이나 메일을 보냄

#### (2) 실시간 데이터 전송

 webhook 방식을 사용하면 매번 요청할 필요 없이 이벤트가 발생했을 때만 서버가 클라이언트로 실시간 데이터를 전송할 수 있게 된다.

#### (3) 통신 경량화

API 방식으로 실시간 데이터를 전송하려면 클라이언트가 매번 서버로 요청을 보내야 해서 큰 부하는 아니지만 쓸데없는 낭비가 발생하게 된다.

하지만 webhook 방식은 이벤트가 발생했을 때만 서버가 클라이언트에 데이터를 보내기 때문에 간단하고 빠르게 통신을 할 수 있게 된다.

<br>

### 2) Webhook의 작동 원리

- webhook을 사용하려는 서비스(서버)에서 webhook URL을 설정한다. (콜백 url을 설정)
  - 해당 url은 서버가 이벤트를 감지하고 데이터를 보낼 때, 이를 받을 클라이언트의 엔드 포인트이다.
- 서버에서 특정 이벤트가 발생하면 webhook이 트리거된다.
- 서버는 webhook url에 지정된 엔드포인트로 HTTP POST 요청을 보내서 이벤트와 관련된 데이터를 전송한다.
- 데이터를 수신한 클라이언트를 이를 처리하고, webhook이 성공적으로 처리되었음을 응답으로 반환할 수 있다.

<br>

### 3) Webhook의 장/단점

#### (1) 장점

- 효율성
  - 불필요한 폴링 없이 필요한 이벤트가 발생했을 때만 통신을 하기 때문에 네트워크 리소스를 절약할 수 있다
- 실시간 데이터 처리
  - 일반적인 api 기반의 폴링 방식에 비해 이벤트 중심의 작업을 거의 실시간으로 처리할 수 있다.
- 간단한 구현 및 사용
  - 서버에서는 특정 이벤트가 발생했을 때 이를 보낼 webhook url을 설정하면 되고 webhook도 결국 http post 방식으로 동작하기 때문에 rest api 방식으로 구현이 가능하다.

#### (2) 단점

- 보안 이슈
  - webhook url은 일반적으로 공개된 url을 사용하기 때문에 외부에서 해당 url로 악의적인 post 요청을 보낼 가능성이 있다. 따라서 지정된 서버만 해당 webhook url을 이용하는 등의 보안적 조치가 필요할 수도 있다.
- 신뢰성 문제
  - 이벤트가 발생했을 때만 http post요청을 보내는데, 만약 네트워크 상의 이슈로 데이터를 보내는데 실패했다면 특정 시간 이후 이를 재시도하는 로직이 필요하다. 그렇지 않으면 네트워크 이슈가 있던 시간대의 이벤트는 클라이언트가 영영 알지 못하게 될 수도 있다.
- 예외 처리
  - webhook으로 보낸 데이터가 유실되어 클라이언트가 정상적인 응답을 서버로 보내지 못한다면, 이 때 서버가 재시도 로직에 의해 계속해서 요청을 보낼 수도 있기 때문에 이러한 시나리오와 예외를 생각해서 잘 구현을 해야 한다. 그렇지 않으면 낭비가 발생할 수 있다.
